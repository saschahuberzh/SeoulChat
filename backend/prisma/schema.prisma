generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  online
  away
  do_not_disturb
  hidden
}

model User {
  id            Int       @id @default(autoincrement())
  username      String    @unique
  password      String
  email         String?   @unique
  displayName   String?
  avatarUrl     String?
  status        UserStatus @default(online)
  statusMessage String?
  lastSeen      DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  refreshTokens RefreshToken[]
  groups        UserGroup[]
  messages      Message[]
  logs          Log[]
}

model RefreshToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  createdAt DateTime @default(now())
}

model Group {
  id            Int       @id @default(autoincrement())
  name          String
  isPrivateChat Boolean?
  avatarUrl     String?
  
  users         UserGroup[]
  messages      Message[]
}

model UserGroup {
  user      User   @relation(fields: [userID], references: [id], onDelete: Cascade)
  userID    Int
  group     Group  @relation(fields: [groupID], references: [id], onDelete: Cascade)
  groupID   Int
  
  @@id([userID, groupID])
}

model Message {
  id        Int     @id @default(autoincrement())
  sender    User    @relation(fields: [senderID], references: [id], onDelete: Cascade)
  senderID  Int
  group     Group   @relation(fields: [groupID], references: [id], onDelete: Cascade)
  groupID   Int
  content   String
  createdAt DateTime @default(now())
}

model Log {
  id           Int      @id @default(autoincrement())
  method       String
  url          String
  status       Int?
  responseTime Int?
  userAgent    String?
  ipAddress    String?
  createdAt    DateTime @default(now())
  user         User?    @relation(fields: [userID], references: [id], onDelete: SetNull)
  userID       Int?
}
